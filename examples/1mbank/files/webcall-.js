(function(F){var w=(typeof console!=="undefined")&&console.log&&true;var z="production";var m={scriptSrc:"",initWithScriptSrc:function(N){this.scriptSrc=N},baseUrl:function(){return(this.scriptSrc.match("^((https?:)?//[^/]+/)")||["",""])[1]},basePath:function(){return this.scriptSrc.match(/^(.*)engine\/.+\.js/)?RegExp.$1:""},engineUrl:function(){return this.basePath()+"engine/"},resourcesUrl:function(){return this.basePath()+"${ENV}/${APP}/"},iframeId:"webcall-frame-${SUFFIX}",windowId:"webcallwindow",proxyFrameId:"webcall-proxy-frame"+c(),buttonId:"webcall-button-"+c(),placeholderId:"webcall-button-placeholder-${ID}",width:390,height:430,app:null};var I="*";var A=[];var t={window:null,opened:false,ready:false};var E={window:null,opened:false,ready:false,iframe:null};var B=[];var g=[],d=2000000,L=2000000,J=[];var e=function(){var Q;var P=B;if(arguments.length===1){Q=arguments[0]}else{P=arguments[0] instanceof Array?arguments[0]:[arguments[0]];Q=arguments[1]}if(!P.length){return false}if(Q){for(var N=0;N<P.length;N++){var O=P[N];F.setTimeout(function(S,T,R){return function(){try{S.postMessage(K(T),I)}catch(U){if(R){console.log(S);console.log(U)}}}}(O,Q,w),0)}}return true};var C=function(T){var V=T.source;var P=D(T.data);if(!P||!P.action){return}if(w){console.log("webcall-inject.js RECEIVED a message: "+P.action)}var Q,U,N;for(var R=0;R<g.length;R++){if(g[R].window===V){Q=g[R];break}}if(Q){U=Q.webcallButton}else{for(var R=0;R<A.length;R++){if(A[R].window===V||A[R].webcallWindow===V){U=A[R];Q=U.webcallFrame;break}}}if(U){N=U.params}switch(P.action){case"Toggle":if(Q.opened){n(Q);return}Q.shouldBeOpened=true;if(P.message.target==="window"){h(N)}else{G(Q)}break;case"SetMessageSender":for(var R=0;R<B.length;R++){if(B[R]===V){return}}B.push(V);try{if(V.name==P.windowId||V.name==P.proxyFrameId){t.ready=true;H(E.window||t.window)}}catch(T){}if(Q&&V===Q.window){Q.ready=true;u(Q.window)}break;case"GetOptions":if(w){console.log("SetOptions called")}if(!N){return}e(Q.window,{action:"SetOptions",message:{app:N.app,env:N.env,referer:F.location.href}});break;case"OptionsSet":e(Q.window,{action:"GetQueueState"});Q.fullyLoaded=true;M(Q);break;case"UpdateQueueState":if(!P.queueUpdates){break}var O=document.getElementById(P.queueUpdates.remainingTime);if(O){O.innerHTML=P.message.expectedWaitTime}var S=document.getElementById(P.queueUpdates.inLine);if(S){S.innerHTML=P.message.inQueue}break;case"Close":if(Q){n(Q)}break;case"ResizeAppFrame":if(Q){f(Q.iframe,P.message)}break;case"ResizeButtonFrame":f(U.iframe,P.message);break;case"console.log":if(w){console.log(P.message)}break}};function M(N){if(N){if(w){console.log("fullyLoaded = "+N.fullyLoaded);console.log("shouldBeOpened = "+N.shouldBeOpened)}if(N.fullyLoaded&&N.shouldBeOpened){e(N.window,{action:"Open"})}}}function c(){return(Math.random()*9999999|0).toString()}function f(N,O){O.width++;O.height++;N.width=O.width;N.height=O.height;N.style.width=O.width+"px";N.style.height=O.height+"px"}function n(N){N.opened=false;N.iframe.style.display="none";d=Math.min(d,+N.iframe.style.zIndex-1);N.iframe.style.zIndex=0;e(N.window,{action:"Stop"})}function G(O){if(!O.ready){O.iframe.src=O.url}F.setTimeout(function(Q,R){return function(){var T=[];for(var S=0;S<Q.length;S++){if(Q[S]!==R){T.push(Q[S]);n(Q[S])}}}}(g,O),50);var N=function(R,U){var S=false;try{var Q=R.iframe.contentWindow||R.iframe;S=!!Q.document.body.innerHTML.length}catch(T){S=true}if(!S){F.setTimeout(function(){N(R,U)},50)}else{U(R)}return arguments.callee};var P=function(Q){Q.iframe.style.display="block";d=Math.max(L,d+1);Q.iframe.style.zIndex=d;Q.opened=true;if(w){console.log(Q.window||Q.iframe.contentWindow)}H(Q.window||Q.iframe.contentWindow)};N(O,P)}function i(){t.opened=false;try{t.window.close();e(webcallFrame.window,{action:"Stop"})}catch(N){}}function h(P){var N=l(P);if(navigator.userAgent.indexOf("MSIE")==-1){t.window=F.open(N,P.windowId,"width="+P.width+",height="+P.height);t.opened=true;H(t.window)}else{var O=K({action:"OpenWindow",message:P});E.window.postMessage(O,I);t.opened=true;H(t.window=E.window)}}function x(S){var N=document.getElementById(S.iframeCaller)||S.placeholder;if(!N){if(w){console.log("WebCall: No iframeCaller element")}return}var P={};g.push(P);try{P.iframe=document.createElement('<iframe name="'+S.iframeId+'" frameborder="0">')}catch(Q){P.iframe=document.createElement("iframe")}var O=l(S);P.url=O;P.params=S;P.iframe.id=S.iframeId.replace("${SUFFIX}",c());P.iframe.className="webcall-iframe";P.iframe.src="about:blank";P.iframe.width=1;P.iframe.height=1;P.iframe.style.zIndex="10000";q(P.iframe);if(!P.updater){P.updater=F.setInterval(function(){P.iframe.style.top=N.offsetTop+N.offsetHeight;P.iframe.style.left=N.offsetLeft},50)}N.parentNode.insertBefore(P.iframe,N.nextSibling);P.window=P.iframe.contentWindow||P.iframe.contentDocument;if(S.iframeCaller){var R=function(){return function(U){for(var T=0;T<g.length;T++){if(g[T].iframe===U){U=g[T]}}if(U.opened){n();return false}U.shouldBeOpened=true;G(U);M();return false}(P)};if(F.addEventListener){N.addEventListener("click",R,false)}else{if(F.attachEvent){N.attachEvent("onclick",R,false)}}}return P}function b(O){var N=document.getElementById(O.windowCaller)||O.placeholder;if(!N){if(w){console.log("WebCall: No windowCaller element")}return}if(navigator.userAgent.indexOf("MSIE")!==-1){v(O,N)}N.onclick=function(P){return function(){if(t.opened){i();return false}h(O);M();return false}(O)};return t}function y(Q){var N=Q.placeholder;if(!N){if(w){console.log("WebCall: Button placeholder element not found")}return}var R=Q.iframeId.replace("${SUFFIX}",c()),P={};A.push(P);try{P.iframe=document.createElement('<iframe name="'+R+'" frameborder="0">')}catch(O){P.iframe=document.createElement("iframe")}q(P.iframe);P.params=Q;P.iframe.id=R;P.iframe.src=Q.resourcesUrl+"/button/button.html"+(w?"?rand="+Math.random():"");P.iframe.width=1;P.iframe.height=1;P.iframe.className="webcall-button";P.iframe.style.position="relative";P.iframe.style.width="1px";P.iframe.style.height="1px";P.iframe.style.zIndex="9999";P.iframe.style.display="block";N.appendChild(P.iframe);P.window=P.iframe.contentWindow||P.iframe.contentDocument;return P}function v(P,N){if(E.window){return}try{E.iframe=document.createElement('<iframe name="'+P.proxyFrameId+'" frameborder="0">')}catch(O){E.iframe=document.createElement("iframe")}E.iframe.src=P.engineUrl+"ie-postmessage.html"+(w?"?rand="+Math.random():"");E.iframe.id=P.proxyFrameId;E.iframe.width=1;E.iframe.height=1;E.iframe.style.left=N.offsetLeft;E.iframe.style.top=N.offsetTop+N.offsetHeight;E.iframe.style.zIndex="1";q(E.iframe);N.parentNode.insertBefore(E.iframe,N.nextSibling);E.window=E.iframe.contentWindow||E.iframe.contentDocument}function q(N){N.style.display="none";N.style.border="none";N.style.position="absolute";N.style.background="transparent";N.style.overflow="hidden";N.setAttribute("allowTransparency","true");N.frameborder="0"}function H(N){var R;if(!N){return false}try{if(N.name==params.windowId||N.name==params.proxyFrameId){R=t}}catch(Q){}for(var O=0;O<g.length;O++){if(g[O].window===N){var P=R=g[O];break}}if(R&&R.opened&&R.ready){u(N)}}function u(N){e(N.window,{action:"Start"})}function K(Q){if(F.JSON&&typeof F.JSON.stringify==="function"){return F.JSON.stringify(Q)}var O=[];for(var N in Q){var R='"'+N+'":';if(typeof Q[N]==="object"){try{if(!Q[N].hasOwnProperty("tagName")){R+=K(Q[N])}}catch(P){R+='"[unprocessed entry]"'}}else{R+='"'+Q[N]+'"'}O.push(R)}return"{"+O.join(",")+"}"}function D(P){if(typeof P!=="string"||!P){return{}}if(F.JSON&&typeof F.JSON.parse==="function"){return F.JSON.parse(P)}var N=/^[\],:{}\s]*$/,O=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g;if(N.test(P.replace(O,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+P))()}}var r=function(S){var O={};for(var P in m){O[P]=m[P]}S=S||{};for(var P in S){O[P]=S[P]}S=O;m.app=S.app;z=S.env||z;if(w){console.log(S)}var Q=x(S);var N=b(S);var R=y(S);R.webcallFrame=Q;R.webcallWindow=N;Q.webcallButton=R};function a(N){if(N){m.initWithScriptSrc(N.getAttribute("src"));var P=N.getAttribute("data-app-id"),T=N.getAttribute("data-env")||z,V=document.createElement("div"),S=N.getAttribute("data-app-id")+"-"+T+"-"+c(),U=m.baseUrl(),Q=m.engineUrl(),O=m.resourcesUrl().replace("${ENV}",T).replace("${APP}",P);V.id=m.placeholderId.replace("${ID}",S);V.className="webcall-button-placeholder";V.style.width="1px";N.parentNode.insertBefore(V,N);var R={app:P,env:T,placeholder:V,scriptTag:N,baseUrl:U,engineUrl:Q,resourcesUrl:O},W=new r(R)}}function l(Q){var O=Q.engineUrl+"webcall.html",P=Q.env||z;var N=[];N.push("app="+Q.app);if(P!=="production"){N.push("env="+P)}if(w){N.push("rand="+Math.random())}if(N.length){O+="?"+N.join("&")}return O}function s(){var Q=document.getElementsByTagName("SCRIPT");for(var O=0,N=Q.length;O<N;O++){var P=Q[O];if((P.className==="webcall-script"||P.getAttribute("class")==="webcall-script")&&(!P.previousSibling||(P.previousSibling&&P.previousSibling.className!=="webcall-button-placeholder")&&(!P.previousSibling.previousSibling||P.previousSibling.previousSibling&&P.previousSibling.previousSibling.className!=="webcall-button-placeholder"))){a(P)}}}var j=function(P){var O=this;if(typeof P!=="object"){throw"WebCallWidget constructor params should be an object."}this._appId=null;this._url=null;this._widgetHandler={};function N(){J.push(O);var U=document.getElementById("webcall-widget-script");if(!U){throw ("WebCallWidget: script#webcall-widget-script not found on the web page.")}m.initWithScriptSrc(U.getAttribute("src"));var V=P.app,S=P.env||m.env,T=m.baseUrl(),R=m.engineUrl(),W=m.resourcesUrl().replace("${ENV}",S).replace("${APP}",V);O._url=l({app:V,engineUrl:R,env:S});if(typeof P.widgetType!=="string"){throw"WebCallWidget: widgetType parameter must be a string."}var Q;switch(P.widgetType.toLowerCase()){case"newwindow":Q=p;break;case"centerediframe":Q=o;break;default:throw"WebCallWidget: Unknown widgetType [new WebCallWidget({widgetType: "+P.widgetType+"})].";break}O._widgetHandler=new Q({app:P.app,url:O._url});return O._widgetHandler}return N()};j.prototype={show:function(){return this}};function k(N,O){for(var P in O.prototype){if(!Object.prototype.hasOwnProperty.call(N.prototype,P)){N.prototype[P]=O.prototype[P]}}N.prototype.constructor=N;N.prototype.parent=O.prototype;return N}var p=function(N){this._url=N.url;this._app=N.app;return this};p.prototype={show:function(){var N=this,O="width="+m.width+",height="+m.height;F.open(N._url,m.windowId,O);return N}};k(p,j);var o=function(N){this._url=N.url;this._app=N.app;return this};k(o,j);if(!F.WebCallWidget){if(F.addEventListener){F.addEventListener("message",C,false)}else{if(F.attachEvent){F.attachEvent("onmessage",C,false)}}F.WebCallWidget=j}g=(F._webCallWebcallFrames=F._webCallWebcallFrames||g);A=(F._webCallWebcallButtons=F._webCallWebcallButtons||A);d=(F._webCallMaxZIndex=F._webCallMaxZIndex||d);J=(F._webCallWidgetInstances=F._webCallWidgetInstances||J);E=(F._webcallProxyFrame=F._webcallProxyFrame||E);s()})(window);